# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

## Сборка

```
npm run build
```

## Данные и типы данных, используемые в приложении

Тип событий по клику

```
type ModalActions = {
	onClick: () => void;
};
```

Карточка продукта

```
interface IProduct {
	id: string;
	title: string;
	description: string;
	image: string;
	category: string;
	price: number;
	counter?: HTMLElement;
	deleteBtn?: HTMLElement;
}

```

Корзина

```
interface ICart {
	products: IProduct[];
	totalPrice: number;
	counter: number;
	addProduct: (product: IProduct) => void;
	removeProduct: (index: number) => void;
	clear: () => void;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

### Слой данных

#### Класс ProductApi

Отвечает за получение данных о товарах.\
Имеет следующие поля:

- `baseUrl: string` - баззовая ссылка для API\
- `settings?: RequestInit` - настройки запроса\

Методы:

- `getProducts() => Promise<IProduct[]>` - возвращает список всех товаров\

#### Класс Cart

Отвечает за корзину с товарами и логику работы с ней.\
Имеет следующие поля:

- `products : IProduct[]` - массив товаров, которые находятся в корзине\
- `totalPrice: number` - суммарная цена всех товаров в корзине\
- `counter: number` - количество товаров в корзине\

Методы:

- `addProduct: (product: IProduct) => void` - добавляет товар в корзину
- `removeProduct: (index: number) => void` - удаляет товар из корины
- `clear: () => void` - очищает корзину, например, при завершении оформления заказа

#### Класс Order

Отвечает за заказ и отправку его на сервер.\
Имеет следующие поля:

- `phone: string` - телефон пользователя
- `address: string` - адрес пользователя
- `payment: string` - способ оплаты
- `email: string` - почта пользователя
- `items: string[]` - список товаров в заказе
- `total: number` - сумма заказа

Методы:

- `setBilling(address: string, payment: string) => void` - устанавливает значения фдреса и способа оплаты\
- `setOrder(phone: string, email: string) => void` - устанавливет телефон и почту пользователя\
- `setItems(items: IProduct[] => void` - устанавливает список товаров и сумму заказа\

### Слой отображения

#### класс Modal

Отвечает за отображение модального окна и его наполнение\
Имеет поля:

- `content: HTMLElement` - наполнение модального окна
- `closeBtn: HTMLElement` - кнопка закрытия
- `actionBtn?: HTMLButtonElement` - дополнительная кнопка, выполняет функцию добавления товара в корзину

Методы:

- `setContent(content: HTMLElement, actions?: ModalActions) => void` - наполняет модальное окно
- `open() => void` - открывает окно
- `close() => void` - закрывает окно

#### класс ProductShort

Отвечает за отображение товара в корзине\
Имеет поля:

- `title: HTMLElement` - название
- `price: HTMLElement` - цена
- `counter: HTMLElement` - счетчик
- `deleteBtn` - кнопка удаления

В конструкторе присваиваются значения всем полям, а на кнопку ставится слушатель для удаления из корзины\

#### класс CartUI

Отвечает за отображение корзины и ее содержимого. А так же для взаимодествия пользователя с ней.\
Имеет следующие поля:

- `model: ICart` - модель корзины
- `content: HTMLElement` - наполнение блока в HTML
- `productList: HTMLElement` - список товаров
- `price: HTMLElement` - общая стоимость
- `count: HTMLElement` - общее количество товаров

Методы:

- `updateContent() => void` - обновляет содержимое корзины\
- `delete(target: HTMLElement, cart: Cart, count: HTMLElement, price: HTMLElement)` - удаляет товар из корзины\

#### класс Buyer

Отвечает за заполнение и валидацию полей формы покупателя.\
Имеет следующие поля:

- `email: HTMLElement` - поле email
- `phone: HTMLElement` - поле телефона
- `content: HTMLElement` - полностью контент в HTML
- `submitButton: HTMLButtonElement` - кнопка подтверждения

Методы:

- `setPhone(phone: string) => void` - ставит начальное значение `+7 (` в поле для улучшения пользовательского опыта
- `checkvalid() => void` - валидирует поля и блокирует/разблокирует кнопку

#### класс BillingForm

Отвечает за заполнение и валидацию полей формы покупателя.\
Имеет следующие поля:

- `address: HTMLElement` - поле адреса
- `content: HTMLElement` - наполнение блока в HTML
- `paymentCard: HTMLElement` - способ оплаты картой
- `paymentCash: HTMLElement` - способ оплаты наличными
- `orderButton: HTMLElement` - кнопка подтверждения

Методы:

- `checkvalid() => void` - валидирует поля и блокирует/разблокирует кнопку

#### класс Complete

Отвечает за вывод сообщения о статусе и сумме заказа после его оформления.\
Имеет следующие поля:

- `button: HTMLElement` - кнопка возврата к каталогу
- `content: HTMLElement` - наполнение блока в HTML
- `totalPrice: HTMLElement` - стоимость заказа

## Взаимодействие компонентов

Взаимодействое осуществляется за счёт брокера событий, описанного в `types\index.ts`.\

Список всех событий:

-`OPEN_CARD` - открытие карточки продукта\
-`OPEN_CART` - открытие модального окна корзины\
-`CLEAR_CART` - очистка корзины\
-`LOAD` - звгрузка всех товаров\
-`CLOSE_MODAL` - закрытие модального окна\
-`BUY_PRODUCT` - добавление продукта в корзину\
-`SUBMIT_ORDER` - оформление заказа\
-`SUBMIT_BUYER` - подтверждение данных покупателя\
-`SUBMIT_BILLING` - подтверждение адреса и способа оплаты\
